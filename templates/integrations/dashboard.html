{% extends 'base.html' %}

{% block title %}Integrations Center - ifinsure{% endblock %}

{% block content %}
<div class="page-header">
    <div class="page-header-content">
        <h1 class="page-title">Integrations Center</h1>
        <p class="page-subtitle">Manage payment providers, SMS gateways, and third-party services</p>
    </div>
</div>

<!-- Stats Overview -->
<div class="int-stats">
    <div class="int-stat-card">
        <div class="int-stat-icon green">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="24" height="24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
        </div>
        <div class="int-stat-info">
            <span class="int-stat-value">{{ active_integrations }}</span>
            <span class="int-stat-label">Active Integrations</span>
        </div>
    </div>
    <div class="int-stat-card">
        <div class="int-stat-icon blue">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="24" height="24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14v6m-3-3h6M6 10h2a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v2a2 2 0 002 2zm10 0h2a2 2 0 002-2V6a2 2 0 00-2-2h-2a2 2 0 00-2 2v2a2 2 0 002 2zM6 20h2a2 2 0 002-2v-2a2 2 0 00-2-2H6a2 2 0 00-2 2v2a2 2 0 002 2z"></path>
            </svg>
        </div>
        <div class="int-stat-info">
            <span class="int-stat-value">{{ total_providers }}</span>
            <span class="int-stat-label">Available Providers</span>
        </div>
    </div>
    <div class="int-stat-card">
        <div class="int-stat-icon orange">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="24" height="24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
            </svg>
        </div>
        <div class="int-stat-info">
            <span class="int-stat-value">{{ needs_attention|default:0 }}</span>
            <span class="int-stat-label">Needs Attention</span>
        </div>
    </div>
    <div class="int-stat-card">
        <div class="int-stat-icon purple">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="24" height="24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
            </svg>
        </div>
        <div class="int-stat-info">
            <span class="int-stat-value">{{ api_calls_today|default:0 }}</span>
            <span class="int-stat-label">API Calls Today</span>
        </div>
    </div>
</div>

<!-- Integration Categories -->
<div class="int-section">
    <div class="int-section-header">
        <h3>Integration Categories</h3>
    </div>
    <div class="int-category-grid">
        {% for category in categories %}
        <a href="{% url 'integrations:category' category.slug %}" class="int-category-card">
            <div class="int-category-icon">
                {% if category.name == 'payment' %}
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="28" height="28">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                </svg>
                {% elif category.name == 'sms' %}
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="28" height="28">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                </svg>
                {% elif category.name == 'email' %}
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="28" height="28">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                </svg>
                {% elif category.name == 'storage' %}
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="28" height="28">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"></path>
                </svg>
                {% elif category.name == 'analytics' %}
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="28" height="28">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
                {% else %}
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="28" height="28">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M11 4a2 2 0 114 0v1a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-1a2 2 0 100 4h1a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-1a2 2 0 10-4 0v1a1 1 0 01-1 1H7a1 1 0 01-1-1v-3a1 1 0 00-1-1H4a2 2 0 110-4h1a1 1 0 001-1V7a1 1 0 011-1h3a1 1 0 001-1V4z"></path>
                </svg>
                {% endif %}
            </div>
            <div class="int-category-content">
                <h4>{{ category.get_name_display }}</h4>
                <p>{{ category.description|default:"Manage integrations"|truncatechars:50 }}</p>
                <div class="int-category-stats">
                    <span class="active">{{ category.active_count|default:0 }} active</span>
                    <span class="sep"></span>
                    <span class="total">{{ category.provider_count|default:0 }} providers</span>
                </div>
            </div>
            <div class="int-category-arrow">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </div>
        </a>
        {% empty %}
        <div class="int-empty">
            <p>No integration categories configured yet.</p>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Quick Actions -->
<div class="int-section">
    <div class="int-section-header">
        <h3>Quick Actions</h3>
    </div>
    <div class="int-actions-grid">
        <a href="{% url 'integrations:configure' 'mpesa' %}" class="int-action-card">
            <div class="int-action-icon mpesa">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="24" height="24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                </svg>
            </div>
            <h4>Configure M-Pesa</h4>
            <p>Set up M-Pesa Daraja API for mobile payments</p>
        </a>
        <a href="{% url 'integrations:category' 'sms' %}" class="int-action-card">
            <div class="int-action-icon sms">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="24" height="24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                </svg>
            </div>
            <h4>SMS Gateway</h4>
            <p>Africa's Talking or Twilio for notifications</p>
        </a>
        <a href="{% url 'integrations:category' 'email' %}" class="int-action-card">
            <div class="int-action-icon email">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="24" height="24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                </svg>
            </div>
            <h4>Email Service</h4>
            <p>Configure SMTP or SendGrid for email</p>
        </a>
        <a href="{% url 'integrations:logs' %}" class="int-action-card">
            <div class="int-action-icon logs">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="24" height="24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path>
                </svg>
            </div>
            <h4>View Logs</h4>
            <p>Monitor activity and debug issues</p>
        </a>
    </div>
</div>

<!-- Recent Activity -->
<div class="int-section">
    <div class="int-section-header">
        <h3>Recent Activity</h3>
        <a href="{% url 'integrations:logs' %}" class="int-view-all">View All</a>
    </div>
    <div class="int-table-card">
        {% if recent_logs %}
        <table class="int-table">
            <thead>
                <tr>
                    <th>Time</th>
                    <th>Provider</th>
                    <th>Action</th>
                    <th>Status</th>
                    <th>Response</th>
                </tr>
            </thead>
            <tbody>
                {% for log in recent_logs %}
                <tr>
                    <td class="time">{{ log.created_at|timesince }} ago</td>
                    <td class="provider">{{ log.config.provider.name }}</td>
                    <td class="action"><code>{{ log.action }}</code></td>
                    <td>
                        <span class="int-status {% if log.status == 'success' %}success{% elif log.status == 'failed' %}failed{% else %}pending{% endif %}">
                            {{ log.status }}
                        </span>
                    </td>
                    <td class="response">{{ log.response_time_ms|default:"-" }} ms</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="int-empty-table">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="40" height="40">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
            </svg>
            <h4>No Recent Activity</h4>
            <p>Integration logs will appear here once you start using connected services.</p>
        </div>
        {% endif %}
    </div>
</div>

<style>
/* Stats */
.int-stats {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
    margin-bottom: 2rem;
}

@media (max-width: 1000px) {
    .int-stats { grid-template-columns: repeat(2, 1fr); }
}

@media (max-width: 550px) {
    .int-stats { grid-template-columns: 1fr; }
}

.int-stat-card {
    background: white;
    border-radius: 16px;
    padding: 1.25rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    box-shadow: 0 1px 3px rgba(0,0,0,0.06);
}

.int-stat-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.int-stat-icon.green { background: #dcfce7; color: #16a34a; }
.int-stat-icon.blue { background: #dbeafe; color: #2563eb; }
.int-stat-icon.orange { background: #ffedd5; color: #ea580c; }
.int-stat-icon.purple { background: #f3e8ff; color: #9333ea; }

.int-stat-info {
    display: flex;
    flex-direction: column;
}

.int-stat-value {
    font-size: 1.75rem;
    font-weight: 800;
    color: var(--color-gray-900);
    line-height: 1.1;
}

.int-stat-label {
    font-size: 0.8rem;
    color: var(--color-gray-500);
}

/* Sections */
.int-section {
    margin-bottom: 2rem;
}

.int-section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.int-section-header h3 {
    font-size: 1rem;
    font-weight: 700;
    color: var(--color-gray-900);
    margin: 0;
}

.int-view-all {
    font-size: 0.875rem;
    color: var(--color-primary-600);
    text-decoration: none;
    font-weight: 500;
}

.int-view-all:hover {
    color: var(--color-primary-700);
}

/* Category Grid */
.int-category-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
}

@media (max-width: 700px) {
    .int-category-grid { grid-template-columns: 1fr; }
}

.int-category-card {
    background: white;
    border-radius: 16px;
    padding: 1.25rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    text-decoration: none;
    box-shadow: 0 1px 3px rgba(0,0,0,0.06);
    border: 2px solid transparent;
    transition: all 0.2s;
}

.int-category-card:hover {
    border-color: var(--color-primary-200);
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}

.int-category-icon {
    width: 56px;
    height: 56px;
    border-radius: 14px;
    background: linear-gradient(135deg, var(--color-primary-50), var(--color-primary-100));
    color: var(--color-primary-600);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.int-category-content {
    flex: 1;
    min-width: 0;
}

.int-category-content h4 {
    font-size: 0.95rem;
    font-weight: 700;
    color: var(--color-gray-900);
    margin: 0 0 0.25rem;
}

.int-category-content p {
    font-size: 0.8rem;
    color: var(--color-gray-500);
    margin: 0 0 0.5rem;
}

.int-category-stats {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.75rem;
}

.int-category-stats .active {
    color: #16a34a;
    font-weight: 600;
}

.int-category-stats .sep {
    width: 3px;
    height: 3px;
    background: var(--color-gray-300);
    border-radius: 50%;
}

.int-category-stats .total {
    color: var(--color-gray-400);
}

.int-category-arrow {
    color: var(--color-gray-300);
    transition: all 0.2s;
}

.int-category-card:hover .int-category-arrow {
    color: var(--color-primary-500);
    transform: translateX(4px);
}

/* Actions Grid */
.int-actions-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
}

@media (max-width: 900px) {
    .int-actions-grid { grid-template-columns: repeat(2, 1fr); }
}

@media (max-width: 500px) {
    .int-actions-grid { grid-template-columns: 1fr; }
}

.int-action-card {
    background: white;
    border-radius: 16px;
    padding: 1.5rem;
    text-align: center;
    text-decoration: none;
    box-shadow: 0 1px 3px rgba(0,0,0,0.06);
    border: 2px solid transparent;
    transition: all 0.2s;
}

.int-action-card:hover {
    border-color: var(--color-primary-200);
    transform: translateY(-2px);
}

.int-action-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1rem;
}

.int-action-icon.mpesa { background: #dcfce7; color: #16a34a; }
.int-action-icon.sms { background: #dbeafe; color: #2563eb; }
.int-action-icon.email { background: #fef3c7; color: #d97706; }
.int-action-icon.logs { background: #f3e8ff; color: #9333ea; }

.int-action-card h4 {
    font-size: 0.9rem;
    font-weight: 700;
    color: var(--color-gray-900);
    margin: 0 0 0.5rem;
}

.int-action-card p {
    font-size: 0.8rem;
    color: var(--color-gray-500);
    margin: 0;
    line-height: 1.4;
}

/* Table */
.int-table-card {
    background: white;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(0,0,0,0.06);
}

.int-table {
    width: 100%;
    border-collapse: collapse;
}

.int-table th {
    text-align: left;
    padding: 0.875rem 1.25rem;
    background: var(--color-gray-50);
    font-size: 0.7rem;
    font-weight: 700;
    color: var(--color-gray-500);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.int-table td {
    padding: 0.875rem 1.25rem;
    border-top: 1px solid var(--color-gray-100);
    font-size: 0.875rem;
}

.int-table .time {
    color: var(--color-gray-500);
    font-size: 0.8rem;
}

.int-table .provider {
    font-weight: 500;
}

.int-table code {
    background: var(--color-gray-100);
    padding: 0.125rem 0.375rem;
    border-radius: 4px;
    font-size: 0.75rem;
    font-family: monospace;
}

.int-table .response {
    color: var(--color-gray-500);
    font-size: 0.8rem;
}

.int-status {
    display: inline-block;
    font-size: 0.65rem;
    font-weight: 700;
    text-transform: uppercase;
    padding: 0.25rem 0.5rem;
    border-radius: 50px;
}

.int-status.success { background: #dcfce7; color: #166534; }
.int-status.failed { background: #fee2e2; color: #991b1b; }
.int-status.pending { background: #fef3c7; color: #92400e; }

/* Empty States */
.int-empty {
    grid-column: 1 / -1;
    text-align: center;
    padding: 3rem 2rem;
    color: var(--color-gray-400);
}

.int-empty-table {
    text-align: center;
    padding: 4rem 2rem;
    color: var(--color-gray-400);
}

.int-empty-table svg {
    margin-bottom: 1rem;
}

.int-empty-table h4 {
    color: var(--color-gray-600);
    margin: 0 0 0.5rem;
}

.int-empty-table p {
    color: var(--color-gray-400);
    margin: 0;
    font-size: 0.875rem;
}
</style>
{% endblock %}
