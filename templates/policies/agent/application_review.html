{% extends 'base.html' %}
{% load humanize %}

{% block title %}Review Application - ifinsure{% endblock %}

{% block content %}
<div class="page-header">
    <div class="breadcrumbs">
        <a href="{% url 'policies:agent_applications' %}">Applications</a>
        <span>/</span>
        <span>Review {{ application.application_number }}</span>
    </div>
    <h1>Review Application</h1>
    <p>{{ application.application_number }}</p>
</div>

<div class="grid grid-3 gap-6">
    <!-- Application Details -->
    <div class="card" style="grid-column: span 2;">
        <div class="card-header">
            <h4>Application Details</h4>
        </div>
        <div class="card-body">
            <div class="profile-grid mb-6">
                <div class="profile-item">
                    <span class="profile-label">Applicant</span>
                    <span class="profile-value">{{ application.applicant.get_full_name }}</span>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Email</span>
                    <span class="profile-value">{{ application.applicant.email }}</span>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Phone</span>
                    <span class="profile-value">{{ application.applicant.phone|default:"-" }}</span>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Product</span>
                    <span class="profile-value">{{ application.product.name }}</span>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Requested Coverage</span>
                    <span class="profile-value">KES {{ application.requested_coverage|intcomma }}</span>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Term</span>
                    <span class="profile-value">{{ application.requested_term_months }} months</span>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Payment Frequency</span>
                    <span class="profile-value">{{ application.get_payment_frequency_display }}</span>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Calculated Premium</span>
                    <span class="profile-value font-bold">
                        {% if application.calculated_premium %}
                        KES {{ application.calculated_premium|intcomma }}
                        {% else %}
                        <span class="text-muted">Pending</span>
                        {% endif %}
                    </span>
                </div>
            </div>
            
            {% if application.beneficiary_name %}
            <h5>Beneficiary Information</h5>
            <div class="profile-grid mb-6">
                <div class="profile-item">
                    <span class="profile-label">Name</span>
                    <span class="profile-value">{{ application.beneficiary_name }}</span>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Relationship</span>
                    <span class="profile-value">{{ application.beneficiary_relationship|default:"-" }}</span>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Phone</span>
                    <span class="profile-value">{{ application.beneficiary_phone|default:"-" }}</span>
                </div>
            </div>
            {% endif %}
            
            {% if application.notes %}
            <h5>Applicant Notes</h5>
            <p class="text-muted">{{ application.notes }}</p>
            {% endif %}
        </div>
    </div>
    
    <!-- Review Form -->
    <div class="card">
        <div class="card-header">
            <h4>Decision</h4>
        </div>
        <div class="card-body">
            <form method="post">
                {% csrf_token %}
                
                <div class="form-group">
                    <label class="form-label">Action</label>
                    {% for radio in review_form.action %}
                    <div class="form-check mb-2">
                        {{ radio.tag }}
                        <label class="form-check-label" for="{{ radio.id_for_label }}">{{ radio.choice_label }}</label>
                    </div>
                    {% endfor %}
                </div>
                
                <div class="form-group">
                    <label class="form-label">Notes / Reason</label>
                    {{ review_form.notes }}
                    <span class="form-hint">Required for rejection</span>
                </div>
                
                <button type="submit" class="btn btn-primary btn-block">
                    Submit Decision
                </button>
            </form>
        </div>
    </div>
    
    <!-- Product Info -->
    <div class="card" style="grid-column: span 3;">
        <div class="card-header">
            <h4>Product: {{ application.product.name }}</h4>
        </div>
        <div class="card-body">
            <div class="profile-grid">
                <div class="profile-item">
                    <span class="profile-label">Category</span>
                    <span class="profile-value">{{ application.product.get_category_display }}</span>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Min Coverage</span>
                    <span class="profile-value">KES {{ application.product.min_coverage|intcomma }}</span>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Max Coverage</span>
                    <span class="profile-value">KES {{ application.product.max_coverage|intcomma }}</span>
                </div>
                <div class="profile-item">
                    <span class="profile-label">Base Premium</span>
                    <span class="profile-value">KES {{ application.product.base_premium|intcomma }}/year</span>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.profile-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-4);
}

.profile-item {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-1);
}

.profile-label {
    font-size: var(--font-size-xs);
    color: var(--color-gray-500);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.profile-value {
    font-size: var(--font-size-base);
    color: var(--color-gray-900);
}
</style>
{% endblock %}
